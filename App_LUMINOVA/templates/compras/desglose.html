{# App_LUMINOVA/templates/compras/compras_desglose.html #}
{% extends 'padre.html' %}
{% load static %}
{% load django_bootstrap5 %}

{% block title %}{{ titulo_seccion|default:"Desglose de Componentes" }}{% endblock %}

{% block sidebar_content %}
    {% include 'compras/compras_sidebar.html' %}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ titulo_seccion }}</h1>
    {# Aquí podría ir un botón para crear una nueva OC manualmente si es necesario #}
</div>

{% bootstrap_messages %}

{% if ordenes_pendientes_list %}
<div class="table-responsive mt-3">
    <table class="table table-hover">
        <thead class="color-thead"> {# Usando tu clase CSS para el encabezado #}
            <tr>
                <th class="text-center align-middle">N° OC</th>
                <th class="text-center align-middle">Estado de OC</th>
                <th class="text-center align-middle">Categoría Insumo</th> {# Asumiendo que es del insumo principal #}
                <th class="text-center align-middle">Fecha Creación</th>
                <th class="text-center align-middle">Insumo Principal</th>
                <th class="text-center align-middle">Cantidad</th>
                <th class="text-center align-middle">Monto Total (US$)</th>
                <th class="text-center align-middle">Fecha Estimada Entrega</th>
                <th class="text-center align-middle">N° Tracking</th>
                <th class="text-center align-middle">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for oc in ordenes_pendientes_list %}
            <tr>
                {# El enlace aquí podría llevar a una vista de detalle de OC o a tu desglose3.html #}
                <td class="text-center align-middle">
                    <a href="#">{{ oc.numero_orden }}</a> {# Ajusta este enlace según tu flujo #}
                </td>
                <td class="text-center align-middle">
                    <span class="badge bg-warning text-dark">{{ oc.get_estado_display_custom }}</span>
                </td>
                <td class="text-center align-middle">{{ oc.insumo_principal.categoria.nombre|default_if_none:"N/A" }}</td>
                <td class="text-center align-middle">{{ oc.fecha_creacion|date:"d/m/Y" }}</td>
                <td class="align-middle">{{ oc.insumo_principal.descripcion|default_if_none:"N/A"|truncatechars:30 }}</td>
                <td class="text-center align-middle">{{ oc.cantidad_principal|default_if_none:"-" }}</td>
                <td class="text-center align-middle">${{ oc.total_orden_compra|floatformat:2 }}</td>
                <td class="text-center align-middle">{{ oc.fecha_estimada_entrega|date:"d/m/Y"|default_if_none:"-" }}</td>
                <td class="text-center align-middle">{{ oc.numero_tracking|default_if_none:"-" }}</td>
                <td class="text-center align-middle">
                    {# Aquí irían los botones para seleccionar proveedor, generar OC final, etc. #}
                    {# Este botón podría llevar a una vista similar a tu desglose3.html para esta OC específica #}
                    <a href="#" class="btn btn-sm btn-primary">Desglosar/Gestionar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info mt-3">
    No hay Órdenes de Compra pendientes de desglose o en el estado seleccionado.
</div>
{% endif %}

{% endblock %}